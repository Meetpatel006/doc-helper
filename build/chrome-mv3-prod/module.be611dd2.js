var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,r,i,n,s){var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof o[n]&&o[n],l=a.cache||{},u="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(e,r){if(!l[e]){if(!t[e]){var i="function"==typeof o[n]&&o[n];if(!r&&i)return i(e,!0);if(a)return a(e,!0);if(u&&"string"==typeof e)return u(e);var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}d.resolve=function(r){var i=t[e][1][r];return null!=i?i:r},d.cache={};var h=l[e]=new c.Module(e);t[e][0].call(h.exports,d,h,h.exports,this)}return l[e].exports;function d(e){var t=d.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=t,c.cache=l,c.parent=a,c.register=function(e,r){t[e]=[function(e,t){t.exports=r},{}]},Object.defineProperty(c,"root",{get:function(){return o[n]}}),o[n]=c;for(var h=0;h<r.length;h++)c(r[h]);if(i){var d=c(i);"object"==typeof exports&&"undefined"!=typeof module?module.exports=d:"function"==typeof e&&e.amd?e(function(){return d}):s&&(this[s]=d)}}({"8UfFv":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.QuickJSWASMModule=r.applyModuleEvalRuntimeOptions=r.applyBaseRuntimeOptions=r.QuickJSModuleCallbacks=void 0;let i=e("7e58038302f623a"),n=e("f16ac3e8a6a2d051"),s=e("b7501cce9627fd58"),o=e("4c781fe844a48dfc"),a=e("3d5fedf1e75e76c6");class l{constructor(e){this.callFunction=e.callFunction,this.shouldInterrupt=e.shouldInterrupt,this.loadModuleSource=e.loadModuleSource,this.normalizeModule=e.normalizeModule}}class u{constructor(e){this.contextCallbacks=new Map,this.runtimeCallbacks=new Map,this.suspendedCount=0,this.cToHostCallbacks=new l({callFunction:(e,t,r,i,n,s)=>this.handleAsyncify(e,()=>{try{let e=this.contextCallbacks.get(t);if(!e)throw Error(`QuickJSContext(ctx = ${t}) not found for C function call "${s}"`);return e.callFunction(t,r,i,n,s)}catch(e){return console.error("[C to host error: returning null]",e),0}}),shouldInterrupt:(e,t)=>this.handleAsyncify(e,()=>{try{let e=this.runtimeCallbacks.get(t);if(!e)throw Error(`QuickJSRuntime(rt = ${t}) not found for C interrupt`);return e.shouldInterrupt(t)}catch(e){return console.error("[C to host interrupt: returning error]",e),1}}),loadModuleSource:(e,t,r,i)=>this.handleAsyncify(e,()=>{try{let e=this.runtimeCallbacks.get(t);if(!e)throw Error(`QuickJSRuntime(rt = ${t}) not found for C module loader`);let n=e.loadModuleSource;if(!n)throw Error(`QuickJSRuntime(rt = ${t}) does not support module loading`);return n(t,r,i)}catch(e){return console.error("[C to host module loader error: returning null]",e),0}}),normalizeModule:(e,t,r,i,n)=>this.handleAsyncify(e,()=>{try{let e=this.runtimeCallbacks.get(t);if(!e)throw Error(`QuickJSRuntime(rt = ${t}) not found for C module loader`);let s=e.normalizeModule;if(!s)throw Error(`QuickJSRuntime(rt = ${t}) does not support module loading`);return s(t,r,i,n)}catch(e){return console.error("[C to host module loader error: returning null]",e),0}})}),this.module=e,this.module.callbacks=this.cToHostCallbacks}setRuntimeCallbacks(e,t){this.runtimeCallbacks.set(e,t)}deleteRuntime(e){this.runtimeCallbacks.delete(e)}setContextCallbacks(e,t){this.contextCallbacks.set(e,t)}deleteContext(e){this.contextCallbacks.delete(e)}handleAsyncify(e,t){if(e)return e.handleSleep(e=>{try{let r=t();if(!(r instanceof Promise)){(0,i.debugLog)("asyncify.handleSleep: not suspending:",r),e(r);return}if(this.suspended)throw new n.QuickJSAsyncifyError(`Already suspended at: ${this.suspended.stack}
Attempted to suspend at:`);this.suspended=new n.QuickJSAsyncifySuspended(`(${this.suspendedCount++})`),(0,i.debugLog)("asyncify.handleSleep: suspending:",this.suspended),r.then(t=>{this.suspended=void 0,(0,i.debugLog)("asyncify.handleSleep: resolved:",t),e(t)},e=>{(0,i.debugLog)("asyncify.handleSleep: rejected:",e),console.error("QuickJS: cannot handle error in suspended function",e),this.suspended=void 0})}catch(e){throw(0,i.debugLog)("asyncify.handleSleep: error:",e),this.suspended=void 0,e}});let r=t();if(r instanceof Promise)throw Error("Promise return value not supported in non-asyncify context.");return r}}function c(e,t){t.interruptHandler&&e.setInterruptHandler(t.interruptHandler),void 0!==t.maxStackSizeBytes&&e.setMaxStackSize(t.maxStackSizeBytes),void 0!==t.memoryLimitBytes&&e.setMemoryLimit(t.memoryLimitBytes)}function h(e,t){t.moduleLoader&&e.setModuleLoader(t.moduleLoader),t.shouldInterrupt&&e.setInterruptHandler(t.shouldInterrupt),void 0!==t.memoryLimitBytes&&e.setMemoryLimit(t.memoryLimitBytes),void 0!==t.maxStackSizeBytes&&e.setMaxStackSize(t.maxStackSizeBytes)}r.QuickJSModuleCallbacks=u,r.applyBaseRuntimeOptions=c,r.applyModuleEvalRuntimeOptions=h,r.QuickJSWASMModule=class{constructor(e,t){this.module=e,this.ffi=t,this.callbacks=new u(e)}newRuntime(e={}){let t=new s.Lifetime(this.ffi.QTS_NewRuntime(),void 0,e=>{this.callbacks.deleteRuntime(e),this.ffi.QTS_FreeRuntime(e)}),r=new o.QuickJSRuntime({module:this.module,callbacks:this.callbacks,ffi:this.ffi,rt:t});return c(r,e),e.moduleLoader&&r.setModuleLoader(e.moduleLoader),r}newContext(e={}){let t=this.newRuntime(),r=t.newContext({...e,ownedLifetimes:(0,a.concat)(t,e.ownedLifetimes)});return t.context=r,r}evalCode(e,t={}){return s.Scope.withScope(r=>{let i=r.manage(this.newContext());h(i.runtime,t);let n=i.evalCode(e,"eval.js");if(void 0!==t.memoryLimitBytes&&i.runtime.setMemoryLimit(-1),n.error){let e=i.dump(r.manage(n.error));throw e}let s=i.dump(r.manage(n.value));return s})}getFFI(){return this.ffi}}},{"7e58038302f623a":"2JqP3",f16ac3e8a6a2d051:"6rKqW",b7501cce9627fd58:"3PNRg","4c781fe844a48dfc":"6l28Q","3d5fedf1e75e76c6":"1OzQ7"}],"2JqP3":[function(e,t,r){e("f37bf904062f5b84"),Object.defineProperty(r,"__esModule",{value:!0}),r.debugLog=r.QTS_DEBUG=void 0,r.QTS_DEBUG=!1,r.debugLog=r.QTS_DEBUG?console.log.bind(console):()=>{}},{f37bf904062f5b84:"7bs1J"}],"7bs1J":[function(e,t,r){var i,n,s,o,a=Object.create,l=Object.defineProperty,u=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,h=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,f=(e,t,r,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of c(t))d.call(e,n)||n===r||l(e,n,{get:()=>t[n],enumerable:!(i=u(t,n))||i.enumerable});return e},m=(e,t,r)=>(r=null!=e?a(h(e)):{},f(!t&&e&&e.__esModule?r:l(r,"default",{value:e,enumerable:!0}),e)),p=(i=(e,t)=>{var r,i,n=t.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var l,u=[],c=!1,h=-1;function d(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&f())}function f(){if(!c){var e=a(d);c=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new m(e,t)),1!==u.length||c||a(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}},()=>(n||i((n={exports:{}}).exports,n),n.exports)),v={};((e,t)=>{for(var r in t)l(e,r,{get:t[r],enumerable:!0})})(v,{default:()=>S}),t.exports=f(l({},"__esModule",{value:!0}),v);var y=m(p());s=m(p()),o=t.exports,f(v,s,"default"),o&&f(o,s,"default");var S=y.default},{}],"6rKqW":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.QuickJSMemoryLeakDetected=r.QuickJSAsyncifySuspended=r.QuickJSAsyncifyError=r.QuickJSNotImplemented=r.QuickJSUseAfterFree=r.QuickJSWrongOwner=r.QuickJSUnwrapError=void 0,r.QuickJSUnwrapError=class extends Error{constructor(e,t){super(String(e)),this.cause=e,this.context=t,this.name="QuickJSUnwrapError"}},r.QuickJSWrongOwner=class extends Error{constructor(){super(...arguments),this.name="QuickJSWrongOwner"}},r.QuickJSUseAfterFree=class extends Error{constructor(){super(...arguments),this.name="QuickJSUseAfterFree"}},r.QuickJSNotImplemented=class extends Error{constructor(){super(...arguments),this.name="QuickJSNotImplemented"}},r.QuickJSAsyncifyError=class extends Error{constructor(){super(...arguments),this.name="QuickJSAsyncifyError"}},r.QuickJSAsyncifySuspended=class extends Error{constructor(){super(...arguments),this.name="QuickJSAsyncifySuspended"}},r.QuickJSMemoryLeakDetected=class extends Error{constructor(){super(...arguments),this.name="QuickJSMemoryLeakDetected"}}},{}],"3PNRg":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.Scope=r.WeakLifetime=r.StaticLifetime=r.Lifetime=void 0;let i=e("2d28e1d79f691a20"),n=e("510c13f14c502e88"),s=e("6cb60bd4bb622f8f");class o{constructor(e,t,r,i){this._value=e,this.copier=t,this.disposer=r,this._owner=i,this._alive=!0,this._constructorStack=n.QTS_DEBUG?Error("Lifetime constructed").stack:void 0}get alive(){return this._alive}get value(){return this.assertAlive(),this._value}get owner(){return this._owner}get dupable(){return!!this.copier}dup(){if(this.assertAlive(),!this.copier)throw Error("Non-dupable lifetime");return new o(this.copier(this._value),this.copier,this.disposer,this._owner)}consume(e){this.assertAlive();let t=e(this);return this.dispose(),t}dispose(){this.assertAlive(),this.disposer&&this.disposer(this._value),this._alive=!1}assertAlive(){if(!this.alive){if(this._constructorStack)throw new s.QuickJSUseAfterFree(`Lifetime not alive
${this._constructorStack}
Lifetime used`);throw new s.QuickJSUseAfterFree("Lifetime not alive")}}}function a(e,t){let r;try{e.dispose()}catch(e){r=e}if(t&&r)throw Object.assign(t,{message:`${t.message}
 Then, failed to dispose scope: ${r.message}`,disposeError:r}),t;if(t||r)throw t||r}r.Lifetime=o,r.StaticLifetime=class extends o{constructor(e,t){super(e,void 0,void 0,t)}get dupable(){return!0}dup(){return this}dispose(){}},r.WeakLifetime=class extends o{constructor(e,t,r,i){super(e,t,r,i)}dispose(){this._alive=!1}};class l{constructor(){this._disposables=new o(new Set)}static withScope(e){let t;let r=new l;try{return e(r)}catch(e){throw t=e,e}finally{a(r,t)}}static withScopeMaybeAsync(e,t){return(0,i.maybeAsync)(void 0,function*(r){let i;let n=new l;try{return yield*r.of(t.call(e,r,n))}catch(e){throw i=e,e}finally{a(n,i)}})}static async withScopeAsync(e){let t;let r=new l;try{return await e(r)}catch(e){throw t=e,e}finally{a(r,t)}}manage(e){return this._disposables.value.add(e),e}get alive(){return this._disposables.alive}dispose(){let e=Array.from(this._disposables.value.values()).reverse();for(let t of e)t.alive&&t.dispose();this._disposables.dispose()}}r.Scope=l},{"2d28e1d79f691a20":"kWg2d","510c13f14c502e88":"2JqP3","6cb60bd4bb622f8f":"6rKqW"}],kWg2d:[function(e,t,r){function*i(e){return yield e}function n(e){return function t(r){return r.done?r.value:r.value instanceof Promise?r.value.then(r=>t(e.next(r)),r=>t(e.throw(r))):t(e.next(r.value))}(e.next())}Object.defineProperty(r,"__esModule",{value:!0}),r.awaitEachYieldedPromise=r.maybeAsync=r.maybeAsyncFn=void 0,i.of=function(e){return i(n(e))},r.maybeAsyncFn=function(e,t){return(...r)=>{let s=t.call(e,i,...r);return n(s)}},r.maybeAsync=function(e,t){let r=t.call(e,i);return n(r)},r.awaitEachYieldedPromise=n},{}],"6l28Q":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.QuickJSRuntime=void 0;let i=e("316ef459ae0e328b"),n=e("325c87c4d69ab12"),s=e("43bf45b29c0673ac"),o=e("90f672ecaa0ad365"),a=e("9cf3735d523c975d"),l=e("dd9be8051e05a68d"),u=e("1f955ca6c6ccdb90");r.QuickJSRuntime=class{constructor(e){this.scope=new a.Scope,this.contextMap=new Map,this.cToHostCallbacks={shouldInterrupt:e=>{if(e!==this.rt.value)throw Error("QuickJSContext instance received C -> JS interrupt with mismatched rt");let t=this.interruptHandler;if(!t)throw Error("QuickJSContext had no interrupt handler");return t(this)?1:0},loadModuleSource:(0,i.maybeAsyncFn)(this,function*(e,t,r,i){let n=this.moduleLoader;if(!n)throw Error("Runtime has no module loader");if(t!==this.rt.value)throw Error("Runtime pointer mismatch");let o=this.contextMap.get(r)??this.newContext({contextPointer:r});try{let t=yield*e(n(i,o));if("object"==typeof t&&"error"in t&&t.error)throw(0,s.debugLog)("cToHostLoadModule: loader returned error",t.error),t.error;let r="string"==typeof t?t:"value"in t?t.value:t;return this.memory.newHeapCharPointer(r).value}catch(e){return(0,s.debugLog)("cToHostLoadModule: caught error",e),o.throw(e),0}}),normalizeModule:(0,i.maybeAsyncFn)(this,function*(e,t,r,i,n){let o=this.moduleNormalizer;if(!o)throw Error("Runtime has no module normalizer");if(t!==this.rt.value)throw Error("Runtime pointer mismatch");let a=this.contextMap.get(r)??this.newContext({contextPointer:r});try{let t=yield*e(o(i,n,a));if("object"==typeof t&&"error"in t&&t.error)throw(0,s.debugLog)("cToHostNormalizeModule: normalizer returned error",t.error),t.error;let r="string"==typeof t?t:t.value;return a.getMemory(this.rt.value).newHeapCharPointer(r).value}catch(e){return(0,s.debugLog)("normalizeModule: caught error",e),a.throw(e),0}})},e.ownedLifetimes?.forEach(e=>this.scope.manage(e)),this.module=e.module,this.memory=new l.ModuleMemory(this.module),this.ffi=e.ffi,this.rt=e.rt,this.callbacks=e.callbacks,this.scope.manage(this.rt),this.callbacks.setRuntimeCallbacks(this.rt.value,this.cToHostCallbacks),this.executePendingJobs=this.executePendingJobs.bind(this)}get alive(){return this.scope.alive}dispose(){return this.scope.dispose()}newContext(e={}){if(e.intrinsics&&e.intrinsics!==u.DefaultIntrinsics)throw Error("TODO: Custom intrinsics are not supported yet");let t=new a.Lifetime(e.contextPointer||this.ffi.QTS_NewContext(this.rt.value),void 0,e=>{this.contextMap.delete(e),this.callbacks.deleteContext(e),this.ffi.QTS_FreeContext(e)}),r=new n.QuickJSContext({module:this.module,ctx:t,ffi:this.ffi,rt:this.rt,ownedLifetimes:e.ownedLifetimes,runtime:this,callbacks:this.callbacks});return this.contextMap.set(t.value,r),r}setModuleLoader(e,t){this.moduleLoader=e,this.moduleNormalizer=t,this.ffi.QTS_RuntimeEnableModuleLoader(this.rt.value,this.moduleNormalizer?1:0)}removeModuleLoader(){this.moduleLoader=void 0,this.ffi.QTS_RuntimeDisableModuleLoader(this.rt.value)}hasPendingJob(){return!!this.ffi.QTS_IsJobPending(this.rt.value)}setInterruptHandler(e){let t=this.interruptHandler;this.interruptHandler=e,t||this.ffi.QTS_RuntimeEnableInterruptHandler(this.rt.value)}removeInterruptHandler(){this.interruptHandler&&(this.ffi.QTS_RuntimeDisableInterruptHandler(this.rt.value),this.interruptHandler=void 0)}executePendingJobs(e=-1){let t=this.memory.newMutablePointerArray(1),r=this.ffi.QTS_ExecutePendingJob(this.rt.value,e??-1,t.value.ptr),i=t.value.typedArray[0];if(t.dispose(),0===i)return this.ffi.QTS_FreeValuePointerRuntime(this.rt.value,r),{value:0};let n=this.contextMap.get(i)??this.newContext({contextPointer:i}),s=n.getMemory(this.rt.value).heapValueHandle(r),o=n.typeof(s);if("number"===o){let e=n.getNumber(s);return s.dispose(),{value:e}}{let e=Object.assign(s,{context:n});return{error:e}}}setMemoryLimit(e){if(e<0&&-1!==e)throw Error("Cannot set memory limit to negative number. To unset, pass -1");this.ffi.QTS_RuntimeSetMemoryLimit(this.rt.value,e)}computeMemoryUsage(){let e=this.getSystemContext().getMemory(this.rt.value);return e.heapValueHandle(this.ffi.QTS_RuntimeComputeMemoryUsage(this.rt.value,e.ctx.value))}dumpMemoryUsage(){return this.memory.consumeHeapCharPointer(this.ffi.QTS_RuntimeDumpMemoryUsage(this.rt.value))}setMaxStackSize(e){if(e<0)throw Error("Cannot set memory limit to negative number. To unset, pass 0.");this.ffi.QTS_RuntimeSetMaxStackSize(this.rt.value,e)}assertOwned(e){if(e.owner&&e.owner.rt!==this.rt)throw new o.QuickJSWrongOwner(`Handle is not owned by this runtime: ${e.owner.rt.value} != ${this.rt.value}`)}getSystemContext(){return this.context||(this.context=this.scope.manage(this.newContext())),this.context}}},{"316ef459ae0e328b":"kWg2d","325c87c4d69ab12":"gR0Lt","43bf45b29c0673ac":"2JqP3","90f672ecaa0ad365":"6rKqW","9cf3735d523c975d":"3PNRg",dd9be8051e05a68d:"dmbcC","1f955ca6c6ccdb90":"1OzQ7"}],gR0Lt:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.QuickJSContext=void 0;let i=e("fd8a548bbef47398"),n=e("d341a342c343ff53"),s=e("1458b89550a0f584"),o=e("3c35dac7deac03f3"),a=e("4324857ccc014b33"),l=e("2e3dd4783f4a08d8");class u extends a.ModuleMemory{constructor(e){super(e.module),this.scope=new o.Scope,this.copyJSValue=e=>this.ffi.QTS_DupValuePointer(this.ctx.value,e),this.freeJSValue=e=>{this.ffi.QTS_FreeValuePointer(this.ctx.value,e)},e.ownedLifetimes?.forEach(e=>this.scope.manage(e)),this.owner=e.owner,this.module=e.module,this.ffi=e.ffi,this.rt=e.rt,this.ctx=this.scope.manage(e.ctx)}get alive(){return this.scope.alive}dispose(){return this.scope.dispose()}manage(e){return this.scope.manage(e)}consumeJSCharPointer(e){let t=this.module.UTF8ToString(e);return this.ffi.QTS_FreeCString(this.ctx.value,e),t}heapValueHandle(e){return new o.Lifetime(e,this.copyJSValue,this.freeJSValue,this.owner)}}r.QuickJSContext=class{constructor(e){this._undefined=void 0,this._null=void 0,this._false=void 0,this._true=void 0,this._global=void 0,this._BigInt=void 0,this.fnNextId=-32768,this.fnMaps=new Map,this.cToHostCallbacks={callFunction:(e,t,r,n,s)=>{if(e!==this.ctx.value)throw Error("QuickJSContext instance received C -> JS call with mismatched ctx");let a=this.getFunction(s);if(!a)throw Error(`QuickJSContext had no callback with id ${s}`);return o.Scope.withScopeMaybeAsync(this,function*(e,s){let l=s.manage(new o.WeakLifetime(t,this.memory.copyJSValue,this.memory.freeJSValue,this.runtime)),u=Array(r);for(let e=0;e<r;e++){let t=this.ffi.QTS_ArgvGetJSValueConstPointer(n,e);u[e]=s.manage(new o.WeakLifetime(t,this.memory.copyJSValue,this.memory.freeJSValue,this.runtime))}try{let t=yield*e(a.apply(l,u));if(t){if("error"in t&&t.error)throw(0,i.debugLog)("throw error",t.error),t.error;let e=s.manage(t instanceof o.Lifetime?t:t.value);return this.ffi.QTS_DupValuePointer(this.ctx.value,e.value)}return 0}catch(e){return this.errorToHandle(e).consume(e=>this.ffi.QTS_Throw(this.ctx.value,e.value))}})}},this.runtime=e.runtime,this.module=e.module,this.ffi=e.ffi,this.rt=e.rt,this.ctx=e.ctx,this.memory=new u({...e,owner:this.runtime}),e.callbacks.setContextCallbacks(this.ctx.value,this.cToHostCallbacks),this.dump=this.dump.bind(this),this.getString=this.getString.bind(this),this.getNumber=this.getNumber.bind(this),this.resolvePromise=this.resolvePromise.bind(this)}get alive(){return this.memory.alive}dispose(){this.memory.dispose()}get undefined(){if(this._undefined)return this._undefined;let e=this.ffi.QTS_GetUndefined();return this._undefined=new o.StaticLifetime(e)}get null(){if(this._null)return this._null;let e=this.ffi.QTS_GetNull();return this._null=new o.StaticLifetime(e)}get true(){if(this._true)return this._true;let e=this.ffi.QTS_GetTrue();return this._true=new o.StaticLifetime(e)}get false(){if(this._false)return this._false;let e=this.ffi.QTS_GetFalse();return this._false=new o.StaticLifetime(e)}get global(){if(this._global)return this._global;let e=this.ffi.QTS_GetGlobalObject(this.ctx.value);return this.memory.manage(this.memory.heapValueHandle(e)),this._global=new o.StaticLifetime(e,this.runtime),this._global}newNumber(e){return this.memory.heapValueHandle(this.ffi.QTS_NewFloat64(this.ctx.value,e))}newString(e){let t=this.memory.newHeapCharPointer(e).consume(e=>this.ffi.QTS_NewString(this.ctx.value,e.value));return this.memory.heapValueHandle(t)}newUniqueSymbol(e){let t=("symbol"==typeof e?e.description:e)??"",r=this.memory.newHeapCharPointer(t).consume(e=>this.ffi.QTS_NewSymbol(this.ctx.value,e.value,0));return this.memory.heapValueHandle(r)}newSymbolFor(e){let t=("symbol"==typeof e?e.description:e)??"",r=this.memory.newHeapCharPointer(t).consume(e=>this.ffi.QTS_NewSymbol(this.ctx.value,e.value,1));return this.memory.heapValueHandle(r)}newBigInt(e){if(!this._BigInt){let e=this.getProp(this.global,"BigInt");this.memory.manage(e),this._BigInt=new o.StaticLifetime(e.value,this.runtime)}let t=this._BigInt,r=String(e);return this.newString(r).consume(e=>this.unwrapResult(this.callFunction(t,this.undefined,e)))}newObject(e){e&&this.runtime.assertOwned(e);let t=e?this.ffi.QTS_NewObjectProto(this.ctx.value,e.value):this.ffi.QTS_NewObject(this.ctx.value);return this.memory.heapValueHandle(t)}newArray(){let e=this.ffi.QTS_NewArray(this.ctx.value);return this.memory.heapValueHandle(e)}newPromise(e){let t=o.Scope.withScope(e=>{let t=e.manage(this.memory.newMutablePointerArray(2)),r=this.ffi.QTS_NewPromiseCapability(this.ctx.value,t.value.ptr),i=this.memory.heapValueHandle(r),[s,o]=Array.from(t.value.typedArray).map(e=>this.memory.heapValueHandle(e));return new n.QuickJSDeferredPromise({context:this,promiseHandle:i,resolveHandle:s,rejectHandle:o})});return e&&"function"==typeof e&&(e=new Promise(e)),e&&Promise.resolve(e).then(t.resolve,e=>e instanceof o.Lifetime?t.reject(e):this.newError(e).consume(t.reject)),t}newFunction(e,t){let r=++this.fnNextId;return this.setFunction(r,t),this.memory.heapValueHandle(this.ffi.QTS_NewFunction(this.ctx.value,r,e))}newError(e){let t=this.memory.heapValueHandle(this.ffi.QTS_NewError(this.ctx.value));return e&&"object"==typeof e?(void 0!==e.name&&this.newString(e.name).consume(e=>this.setProp(t,"name",e)),void 0!==e.message&&this.newString(e.message).consume(e=>this.setProp(t,"message",e))):"string"==typeof e?this.newString(e).consume(e=>this.setProp(t,"message",e)):void 0!==e&&this.newString(String(e)).consume(e=>this.setProp(t,"message",e)),t}typeof(e){return this.runtime.assertOwned(e),this.memory.consumeHeapCharPointer(this.ffi.QTS_Typeof(this.ctx.value,e.value))}getNumber(e){return this.runtime.assertOwned(e),this.ffi.QTS_GetFloat64(this.ctx.value,e.value)}getString(e){return this.runtime.assertOwned(e),this.memory.consumeJSCharPointer(this.ffi.QTS_GetString(this.ctx.value,e.value))}getSymbol(e){this.runtime.assertOwned(e);let t=this.memory.consumeJSCharPointer(this.ffi.QTS_GetSymbolDescriptionOrKey(this.ctx.value,e.value)),r=this.ffi.QTS_IsGlobalSymbol(this.ctx.value,e.value);return r?Symbol.for(t):Symbol(t)}getBigInt(e){this.runtime.assertOwned(e);let t=this.getString(e);return BigInt(t)}resolvePromise(e){this.runtime.assertOwned(e);let t=o.Scope.withScope(t=>{let r=t.manage(this.getProp(this.global,"Promise")),i=t.manage(this.getProp(r,"resolve"));return this.callFunction(i,r,e)});return t.error?Promise.resolve(t):new Promise(e=>{o.Scope.withScope(r=>{let i=r.manage(this.newFunction("resolve",t=>{e({value:t&&t.dup()})})),n=r.manage(this.newFunction("reject",t=>{e({error:t&&t.dup()})})),s=r.manage(t.value),o=r.manage(this.getProp(s,"then"));this.unwrapResult(this.callFunction(o,s,i,n)).dispose()})})}getProp(e,t){this.runtime.assertOwned(e);let r=this.borrowPropertyKey(t).consume(t=>this.ffi.QTS_GetProp(this.ctx.value,e.value,t.value)),i=this.memory.heapValueHandle(r);return i}setProp(e,t,r){this.runtime.assertOwned(e),this.borrowPropertyKey(t).consume(t=>this.ffi.QTS_SetProp(this.ctx.value,e.value,t.value,r.value))}defineProp(e,t,r){this.runtime.assertOwned(e),o.Scope.withScope(i=>{let n=i.manage(this.borrowPropertyKey(t)),s=r.value||this.undefined,o=!!r.configurable,a=!!r.enumerable,l=!!r.value,u=r.get?i.manage(this.newFunction(r.get.name,r.get)):this.undefined,c=r.set?i.manage(this.newFunction(r.set.name,r.set)):this.undefined;this.ffi.QTS_DefineProp(this.ctx.value,e.value,n.value,s.value,u.value,c.value,o,a,l)})}callFunction(e,t,...r){this.runtime.assertOwned(e);let i=this.memory.toPointerArray(r).consume(i=>this.ffi.QTS_Call(this.ctx.value,e.value,t.value,r.length,i.value)),n=this.ffi.QTS_ResolveException(this.ctx.value,i);return n?(this.ffi.QTS_FreeValuePointer(this.ctx.value,i),{error:this.memory.heapValueHandle(n)}):{value:this.memory.heapValueHandle(i)}}evalCode(e,t="eval.js",r){let i=void 0===r?1:0,n=(0,l.evalOptionsToFlags)(r),s=this.memory.newHeapCharPointer(e).consume(e=>this.ffi.QTS_Eval(this.ctx.value,e.value,t,i,n)),o=this.ffi.QTS_ResolveException(this.ctx.value,s);return o?(this.ffi.QTS_FreeValuePointer(this.ctx.value,s),{error:this.memory.heapValueHandle(o)}):{value:this.memory.heapValueHandle(s)}}throw(e){return this.errorToHandle(e).consume(e=>this.ffi.QTS_Throw(this.ctx.value,e.value))}borrowPropertyKey(e){return"number"==typeof e?this.newNumber(e):"string"==typeof e?this.newString(e):new o.StaticLifetime(e.value,this.runtime)}getMemory(e){if(e===this.rt.value)return this.memory;throw Error("Private API. Cannot get memory from a different runtime")}dump(e){this.runtime.assertOwned(e);let t=this.typeof(e);if("string"===t)return this.getString(e);if("number"===t)return this.getNumber(e);if("bigint"===t)return this.getBigInt(e);if("undefined"===t)return;if("symbol"===t)return this.getSymbol(e);let r=this.memory.consumeJSCharPointer(this.ffi.QTS_Dump(this.ctx.value,e.value));try{return JSON.parse(r)}catch(e){return r}}unwrapResult(e){if(e.error){let t="context"in e.error?e.error.context:this,r=e.error.consume(e=>this.dump(e));if(r&&"object"==typeof r&&"string"==typeof r.message){let{message:e,name:i,stack:n}=r,o=new s.QuickJSUnwrapError(""),a=o.stack;throw"string"==typeof i&&(o.name=r.name),"string"==typeof n&&(o.stack=`${i}: ${e}
${r.stack}Host: ${a}`),Object.assign(o,{cause:r,context:t,message:e}),o}throw new s.QuickJSUnwrapError(r,t)}return e.value}getFunction(e){let t=this.fnMaps.get(e>>8);if(t)return t.get(e)}setFunction(e,t){let r=e>>8,i=this.fnMaps.get(r);return i||(i=new Map,this.fnMaps.set(r,i)),i.set(e,t)}errorToHandle(e){return e instanceof o.Lifetime?e:this.newError(e)}}},{fd8a548bbef47398:"2JqP3",d341a342c343ff53:"h19K3","1458b89550a0f584":"6rKqW","3c35dac7deac03f3":"3PNRg","4324857ccc014b33":"dmbcC","2e3dd4783f4a08d8":"1OzQ7"}],h19K3:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.QuickJSDeferredPromise=void 0,r.QuickJSDeferredPromise=class{constructor(e){this.resolve=e=>{this.resolveHandle.alive&&(this.context.unwrapResult(this.context.callFunction(this.resolveHandle,this.context.undefined,e||this.context.undefined)).dispose(),this.disposeResolvers(),this.onSettled())},this.reject=e=>{this.rejectHandle.alive&&(this.context.unwrapResult(this.context.callFunction(this.rejectHandle,this.context.undefined,e||this.context.undefined)).dispose(),this.disposeResolvers(),this.onSettled())},this.dispose=()=>{this.handle.alive&&this.handle.dispose(),this.disposeResolvers()},this.context=e.context,this.owner=e.context.runtime,this.handle=e.promiseHandle,this.settled=new Promise(e=>{this.onSettled=e}),this.resolveHandle=e.resolveHandle,this.rejectHandle=e.rejectHandle}get alive(){return this.handle.alive||this.resolveHandle.alive||this.rejectHandle.alive}disposeResolvers(){this.resolveHandle.alive&&this.resolveHandle.dispose(),this.rejectHandle.alive&&this.rejectHandle.dispose()}}},{}],dmbcC:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ModuleMemory=void 0;let i=e("c4ed2b0bb45a5726");r.ModuleMemory=class{constructor(e){this.module=e}toPointerArray(e){let t=new Int32Array(e.map(e=>e.value)),r=t.length*t.BYTES_PER_ELEMENT,n=this.module._malloc(r);return new Uint8Array(this.module.HEAPU8.buffer,n,r).set(new Uint8Array(t.buffer)),new i.Lifetime(n,void 0,e=>this.module._free(e))}newMutablePointerArray(e){let t=new Int32Array(Array(e).fill(0)),r=t.length*t.BYTES_PER_ELEMENT,n=this.module._malloc(r),s=new Int32Array(this.module.HEAPU8.buffer,n,e);return s.set(t),new i.Lifetime({typedArray:s,ptr:n},void 0,e=>this.module._free(e.ptr))}newHeapCharPointer(e){let t=this.module.lengthBytesUTF8(e)+1,r=this.module._malloc(t);return this.module.stringToUTF8(e,r,t),new i.Lifetime(r,void 0,e=>this.module._free(e))}consumeHeapCharPointer(e){let t=this.module.UTF8ToString(e);return this.module._free(e),t}}},{c4ed2b0bb45a5726:"3PNRg"}],"1OzQ7":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.concat=r.evalOptionsToFlags=r.DefaultIntrinsics=void 0;let i=e("c5c230262569da52");Symbol("Unstable"),r.DefaultIntrinsics=Symbol("DefaultIntrinsics"),r.evalOptionsToFlags=function(e){if("number"==typeof e)return e;if(void 0===e)return 0;let{type:t,strict:r,strip:n,compileOnly:s,backtraceBarrier:o}=e,a=0;return"global"===t&&(a|=i.EvalFlags.JS_EVAL_TYPE_GLOBAL),"module"===t&&(a|=i.EvalFlags.JS_EVAL_TYPE_MODULE),r&&(a|=i.EvalFlags.JS_EVAL_FLAG_STRICT),n&&(a|=i.EvalFlags.JS_EVAL_FLAG_STRIP),s&&(a|=i.EvalFlags.JS_EVAL_FLAG_COMPILE_ONLY),o&&(a|=i.EvalFlags.JS_EVAL_FLAG_BACKTRACE_BARRIER),a},r.concat=function(...e){let t=[];for(let r of e)void 0!==r&&(t=t.concat(r));return t}},{c5c230262569da52:"emoYh"}],emoYh:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.EvalFlags=r.assertSync=void 0,r.assertSync=function(e){return function(...t){let r=e(...t);if(r&&"object"==typeof r&&r instanceof Promise)throw Error("Function unexpectedly returned a Promise");return r}},r.EvalFlags={JS_EVAL_TYPE_GLOBAL:0,JS_EVAL_TYPE_MODULE:1,JS_EVAL_TYPE_DIRECT:2,JS_EVAL_TYPE_INDIRECT:3,JS_EVAL_TYPE_MASK:3,JS_EVAL_FLAG_STRICT:8,JS_EVAL_FLAG_STRIP:16,JS_EVAL_FLAG_COMPILE_ONLY:32,JS_EVAL_FLAG_BACKTRACE_BARRIER:64}},{}]},[],null,"parcelRequirefcb8"),globalThis.define=t;